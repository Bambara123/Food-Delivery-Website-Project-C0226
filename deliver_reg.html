<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sign up</title>
  <link rel="stylesheet" type = "text/css" href = "customer_reg.css">
</head>
<body>

  <div class = "background-container">     
  </div>

  <div class="overlay"></div>
  
  <section class = "container">

    <div class = "brand-logo">
      <img src = "images/logo.png" alt = "">

    </div>

    <h1>Sign up to deliver with pride</h1>

    <form id="registration-form" action = "http://localhost/project/deliver_reg.php" class = "form" method = "POST">
 
      <div class = "column">
        <div class = "input-box">
          <label>First name</label>
          <input type = "text" placeholder="Enter last name" name = "f_name" required/>
        </div>
        <div class = "input-box">
          <label>Last name</label>
          <input type = "text" placeholder="Enter last name" name = "l_name" required/>
        </div>

      </div>
      <div class = "input-box">
        <label>Email</label>
        <input type = "text" placeholder="Enter the email" name = "email" required/>
      </div>

      <div class = "input-box">
        <label>Home address</label>
        <input type = "text" placeholder="Street name" name = "address_line1" required/>
      </div>
      <div class = "input-box">
        <input type = "text" placeholder="Enter the address line 2" name = "address_line2"/>
      </div>

      <div class = "input-box">
        <input type = "text" placeholder="Nearest city" name = "home_city" required/>
      </div>

      <div class = "input-box">
        <label>Operate City</label>
        <input type = "text" placeholder="Enter the city you can operate" name = "city" required/>
      </div>

      <div class = "input-box">
        <label>Phone number</label>
        <input type = "text" placeholder="Enter the phone number" name = "p_number" required/>
      </div>


      <div class = "input-box">
        <label>Vehicle registration number</label>
        <input type = "text" placeholder="Enter the city you can operate" name = "vehicle_reg" required/>
      </div>

      <div class = "input-box">
        <label>User name </label>
        <input type = "text" placeholder="Enter a username" id = "username_d" name = "username_d" required/>
      </div>

      <div class = "input-box">
        <label>Password</label>
        <input type = "password" placeholder="Enter a password" name = "password" required/>
      </div>

      <button type ="submit">Sign up</button>      

    </form>

  </section>

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  <script>

    // display the message when user enters existing username
    document.getElementById('registration-form').addEventListener('submit', function(event) {
        event.preventDefault(); // Prevent default form submission

        const form = event.target;
        const formData = new FormData(form);

        // Use AJAX to submit the form data
        fetch(form.action, {
            method: form.method,
            body: formData
        })
        .then(response => response.json())
        .then(data => {

            if (data.usernameNotAvailable) {

                document.getElementById('username_d').value = 'Another Foodipier has taken this user name try different!';
                document.getElementById('username_d').classList.add('error-message');
            } else {
                // Redirect after a short delay
                setTimeout(function() {
                    window.location.href = 'deliver_home.php';
                }, 500); // Redirect after 1/2 seconds
            }
        })
        .catch(error => {
            console.error('Error:', error);
        });
    });


    //  make it black again
    document.getElementById('username_d').addEventListener('input', function() {
        this.classList.remove('error-message');
    });
</script>
  
</body>
</html>